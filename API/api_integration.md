# 電子紙管理系統 API 整合規劃
**(ESL System API Integration Guide)**

電子紙管理系統的 API 列表，以及針對客戶端開發整合的需求評級與實際應用場景。

## 評級說明 (Rating Legend)

針對客戶端自行開發整合的角度進行評級：

*   ⭐⭐⭐⭐⭐ **(5星 - 核心功能)**：系統運作的必要條件，不可或缺。
*   ⭐⭐⭐⭐ **(4星 - 高頻功能)**：大幅提升運營效率或自動化程度的必備功能。
*   ⭐⭐⭐ **(3星 - 輔助功能)**：用於監控、查詢或特定場景。
*   ⭐⭐ **(2星 - 低頻功能)**：通常只需設定一次，或由後台管理員偶爾操作。
*   ⭐ **(1星 - 系統級功能)**：通常由 ESL 供應商後台處理，客戶端整合極少用到。
*   ❓ **(0星 - 無功能 / 不確定)**：需求尚未確認或者無功能，是否整合需視實際應用場景與客戶需求決定。
*   👤 **(替代方案 - 不使用 API)**：改由人工操作、檔案匯入、後台設定或其他非 API 方式達成需求。
---

## Part 1: 登入 (Log in)

系統接入的第一步，涉及安全認證。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **1.1 Log in** | 系統登入 | 👤 | **取得 Token**：所有後續 API 呼叫前的必要認證步驟。 | 統一API key 由管理帳號取得|

---

## Part 2: 門店管理 API (Store API)

本章節包含門店的新增、修改、狀態控制及資訊獲取。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **2.1 Add store** | 新增門店 | ⭐⭐ | **擴點整合**：ERP 建立新分店時，自動在 ESL 系統建立對應門店。 |
| **2.2 Modify store** | 修改門店 | ⭐⭐ | **資訊同步**：更新門店名稱或聯絡資訊。 |
| **2.3 Close / open store** | 開啟/關閉門店 | ⭐ | **裝修暫停**：暫時停用該門店的系統服務。 |
| **2.4 Get warning info** | 獲取告警資訊 | ⭐⭐⭐⭐ | **健康監控**：在總部儀表板顯示哪些門店有離線網關或低電量標籤。 |
| **2.5 Get store info** | 獲取門店資訊 | ⭐⭐⭐ | **狀態確認**：確認門店 ID 是否存在或狀態是否正常。 |
| **2.6 Get operation log** | 獲取操作日誌資訊 | ⭐⭐ | **稽核軌跡**：查詢特定時間內的變價操作紀錄以釐清責任。 |

---

## Part 3: 商品數據 API (Data/product API)

本章節涉及商品資料的管理以及螢幕更新控制。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **3.1 Query dynamic fields** | 查詢動態欄位 | 👤 | **欄位對照**：開發階段確認有哪些預留欄位可用（如：產地、促銷語）。 | 下載json表 | 
| **3.2 Add store data** | 新增門店商品數據 | ⭐⭐⭐⭐⭐ | **商品建檔**：POS 新增商品時，同步將商品資料推送到 ESL 系統。 |
| **3.3 Modify data (brush)** | 修改數據並刷屏 | ⭐⭐⭐⭐⭐ | **即時變價**：POS 修改價格後，立即呼叫此 API 更新電子紙畫面。 |
| **3.4 Modify data batch** | 批量修改數據不刷屏 | ⭐⭐⭐ | **預先載入**：夜間批量更新隔日促銷資料，但不立即刷新畫面。 |
| **3.5 Delete data** | 刪除商品數據 | ⭐⭐⭐⭐ | **商品下架**：清除系統中已停售的商品資料。 |
| **3.6 Get data info** | 獲取商品數據資訊 | ⭐⭐⭐ | **資料核對**：POS 查詢 ESL 系統目前的價格是否與 ERP 一致。 |
| **3.7 Query binding tag** | 查詢商品綁定的標籤 | ⭐⭐⭐ | **反向查詢**：輸入商品條碼，查詢該商品目前綁定了哪顆標籤。 |
| **3.8 Batch Add/Mod & brush**| 批量新增/修改並刷屏 | ⭐⭐⭐⭐⭐ | **批量變價**：每日例行性大量變價（如生鮮早市改晚市），包含 LED 閃爍提示。 |

---

## Part 4: 模板 API (Template API)

本章節用於管理電子紙的顯示版型（Template）。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **4.1 Query template list** | 查詢門店模板列表(名稱、尺寸、顏色) | ⭐⭐⭐ | **版型選擇**：在 PDA 綁定商品時，讓店員選擇「促銷版型」或「一般版型」。 |
| **4.2 Preview (unbound)** | 未綁定數據的模板預覽 | ⭐⭐ | **CMS 預覽**：後台設計版型時的預覽功能。 |
| **4.3 Preview (bound)** | 已綁定數據的模板預覽 | ⭐⭐ | **實機預覽**：預覽特定商品套用某版型後的實際顯示效果。 |

---

## Part 5: 網關 API (Gateway API)

本章節用於管理負責通訊的網關（Gateway/AP）。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **5.1 Add gateway** | 新增網關 | ⭐ | **設備安裝**：工程師安裝新網關時的註冊流程。 |
| **5.2 Delete gateway** | 刪除網關 | ⭐ | **設備撤除**：門店撤店或更換網關硬體時使用。 |
| **5.3 Query gateway list** | 查詢網關列表 | ⭐⭐⭐ | **網路監控**：IT 部門監控各門店網關的在線狀態與 IP。 |
| **5.4 Modify gateway info** | 修改網關資訊 | ⭐ | **參數調整**：修改網關名稱或網路設定。 |

---

## Part 6: 裝置/標籤 API (Device/tag API)

本章節為核心功能，包含標籤（Tag）的綁定、解綁、喚醒及燈光控制。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **6.1 Add devices batch** | 批量新增裝置 | ⭐⭐ | **裝置入庫**：新標籤採購進貨時，批量匯入系統白名單。 | 手動新增裝置(非白名單)
| **6.2 Wake up devices** | 根據 MAC 批量喚醒 | ❓ | **強制喚醒**：維修極少數進入深層睡眠的標籤。 |
| **6.3 Delete devices batch** | 批量刪除裝置 | ⭐⭐ | **裝置報廢**：批量移除損壞或遺失的標籤。 |
| **6.4 Get device list** | 獲取裝置列表 | ⭐⭐⭐⭐ | **資產盤點**：列出門店所有標籤及其狀態（電量、訊號）。 |
| **6.5 Bind devices** | 綁定裝置 | ❓ | **現場綁定**：網關與裝置綁定。 |
| **6.6 Delete the binding relationship between tag and data** | 刪除標籤與數據的綁定關係 | ⭐⭐⭐ | **解除綁定**：商品下架或標籤更換用途時。 |
| **6.7 Light up RGB** | 根據 MAC 點亮 RGB | ❓ | **撿貨/尋貨**：倉儲撿貨或店員找貨時，讓特定標籤閃燈。 |
| **6.8 Refresh tags batch** | 批量刷新標籤(刷屏) | ⭐⭐⭐ | **強制刷新**：畫面殘影或異常時，強制全店標籤重刷一次。 |
| **6.9 Modify & brush the binding relationship of tags, data & templates (brush)** | 修改並刷新標籤、數據與模板的綁定關係（刷屏） | ⭐⭐ | **換檔操作**：直接修改裝置綁定關係並更新畫面。 |
| **6.10 Import system data** | 導入系統數據至門店 | ⭐ | **資料遷移**：系統初始化時的舊資料導入。 |
| **6.11 Add remarks** | 新增裝置備註 | ⭐⭐ | **維修備註**：標記標籤狀態。 |
| **6.12 Query bound data according to label Mac** | 查詢已綁定數據 | ⭐⭐⭐ | **現場查價**：掃描標籤 MAC，確認目前系統認定它顯示什麼商品。 |
| **6.13 Query device info** | 查詢裝置詳細資訊 | ⭐⭐⭐ | **故障排除**：查詢特定標籤的詳細硬體資訊、韌體版本。 |
| **6.14 Query device (Admin)**| 根據 MAC 查詢(管理員) | ⭐⭐ | **管理員查詢**：僅限 Admin 權限的詳細裝置查詢。 |
| **6.15 Query the MAC list of unbound devices in the store or the binding relationship of bound devices**| 查詢門市內未綁定設備的 MAC 列表或已綁定設備的關係 | ⭐⭐⭐ | **尋找閒置標籤**：列出店內所有未綁定的標籤 MAC，供新商品使用。 |
| **6.16 Query the label devices that communicate with gateway** | 查詢與網關通訊的標籤設備 | ⭐⭐ | **訊號優化**：分析哪些標籤連線到哪台網關，優化網關擺放位置。 |
| **6.17 Export the binding list of the warning light and the label** | 匯出警示燈與標籤的綁定列表 | ⭐⭐ | **報表匯出**：匯出目前的亮燈與綁定清單供離線分析。 |
| **6.18 Bind devices with template (multi-data)** | 綁定模板(多商品) | ⭐⭐⭐ | **多頁顯示**：綁定時指定特殊模板（如：顯示多個商品或庫存資訊）。 |

---

## Part 7: 管理員帳號 API (Admin Account API)

本章節用於系統層級的帳號與權限管理，通常由 ESL 廠商後台管理，客戶端日常業務極少整合。

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **7.1 Create master acct** | 建立主帳號 | ⭐ | **後台管理**：建立系統管理員帳號。 |
| **7.2 List Accounts** | 主帳號列表查詢 | ⭐ | **後台管理**：查詢管理員列表。 |
| **7.3 Modify Account** | 修改主帳號 | ⭐ | **後台管理**：修改管理員權限或密碼。 |
| **7.4 Delete Account** | 刪除主帳號 | ⭐ | **後台管理**：移除管理員。 |
| **7.5 Import whitelist** | 導入裝置白名單 | ⭐⭐ | **裝置註冊**：批量導入採購的裝置清單以允許連線。 |

---

## Part 8: APP 應用 API (APP API)

| API | 功能描述 | 評級 | 應用實例 | 備註 |
| :--- | :--- | :---: | :--- | :--- |
| **8.1 Get BT Update Data** | 獲取 APP 藍牙更新數據 | ⭐ | **藍牙更新**：若開發的手機 APP 支援藍牙直接更新標籤（非透過網關），需此數據。 |

## Part 9: API 開發缺口與待補功能 (API Gaps & To-Do)

以下列出在正式開始開發或對外提供上述 API 前，系統仍需補齊或強化的功能模組：

### 9.1 動態圖片功能 (Dynamic Image Support)
- 圖片資源ID關聯
- API 可指定或切換電子紙顯示的動態圖片內容
- 適用場景：促銷圖、品牌圖、活動視覺更新

### 9.2 動態 Icon 功能 (Dynamic Icon Support)
- 提供Icon編輯器
- Icon資源ID關聯
- API 支援依條件（價格、庫存、狀態）動態顯示或切換 Icon
- 適用場景：價格異動提醒、狀態標示、行銷提示